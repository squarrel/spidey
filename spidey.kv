#:kivy 1.9.0

SpideyGame:

<SpideyGame>:
	gameworld: gameworld
	spider_system: spider_system
	beetle_system: beetle_system
	boxes: boxes
	web: web
	panel: panel

	GameWorld:
		id: gameworld
		gamescreenmanager: gamescreenmanager
		size_of_gameworld: 100*1024
		zones: {'general': 20000}
		PositionSystem2D:
			system_id: 'position'
			gameworld: gameworld
			zones: ['general']
			size_of_component_block: 128
		Renderer:
			gameworld: gameworld
			system_id: 'renderer'
			zones: ['general']
			frame_count: 2
			updateable: True
			size_of_batches: 512
			size_of_component_block: 128
			shader_source: 'assets/glsl/positionshader.glsl'
		SpiderSystem:
			id: spider_system
			system_id: 'spider_system'
			gameworld: gameworld
			updateable: True
		BeetleSystem:
			id: beetle_system
			system_id: 'beetle_system'
			boxes: boxes
			gameworld: gameworld
			updateable: True
		Boxes:
			id: boxes
			system_id: 'boxes'
		Web:
			id: web
			system_id: 'web'
			spider_system: spider_system
			boxes: boxes
			canvas:
				Color:
					rgba: .4, .4, 1, 1
				Line:
					points: self.points
					joint: 'round'
					cap: 'round'
					width: 10
					close: False
				Color:
					rgba: .8, .8, .8, 1
				Line:
					points: self.points
					close: False
				Color:
					rgba: 1, .4, .4, .5
				Line:
					points: self.points2
					joint: 'round'
					cap: 'round'
					width: 10
					close: False
		Panel:
			id: panel
			system_id: 'panel'
			Label:
				pos: root.pos[0] * .07, root.pos[1] * .07
				size: root.size[0] * .07, root.size[1] * .07
				font_size: root.size[1] * .03
				color: (1, 1, 1, 1)
				text: 'Score: ' + beetle_system.score_	if gamescreenmanager.current == 'main' else ''

	GameScreenManager:
		id: gamescreenmanager
		size: root.size
		pos: root.pos
		gameworld: gameworld

<GameScreenManager>:
	MenuScreen:
		id: menu_screen
	MainScreen:
		id: main_screen
	MessageScreen:
		id: message_screen
	SettingsScreen:
		id: settings_screen

<MenuScreen@GameScreen>:
	name: 'menu'
	canvas:
		Color:
			rgba: 1, .4, .4, 1
		Rectangle:
			size: self.size
			pos: self.pos
	FloatLayout:
		Label:
			text: 'Spidey Scientist'
			size_hint: (.2, .1)
			pos_hint: {'x': .4, 'y': .90}
		Button:
			text: 'Play'
			size_hint: (.2, .1)
			pos_hint: {'x': .4, 'y': .65}
			on_press: root.manager.current = 'main'
			on_release: root.start_game()
		Button:
			text: 'Settings'
			size_hint: (.2, .1)
			pos_hint: {'x': .4, 'y': .55}
			on_press: root.manager.current = 'settings'
		Button:
			text: 'Exit'
			size_hint: (.2, .1)
			pos_hint: {'x': .4, 'y': .45}
			on_press: app.stop()

<MainScreen@GameScreen>:
	name: 'main'
	FloatLayout:
		Label:
			text: 'Spidey Scientist'
			size_hint: (.2, .1)
			pos_hint: {'x': .4, 'y': .9}
		Button:
			text: 'Stop'
			size_hint: (.2, .1)
			pos_hint: {'x': .8, 'y': .9}
			on_press: root.pause_game()
			on_release: root.manager.current = 'message'

<MessageScreen@GameScreen>:
	name: 'message'
	FloatLayout:
		Label:
			text: 'Paused'
		Button:
			text: 'Resume'
			size_hint: (.2, .1)
			pos_hint: {'x': .45, 'y': .6}
			on_press: root.manager.current = 'main'
			on_release: root.resume_game()
		Button:
			text: 'Settings'
			size_hint: (.2, .1)
			pos_hint: {'x': .45, 'y': .45}
			on_press: root.manager.current = 'settings'
		Button:
			text: 'Exit to main menu'
			size_hint: (.2, .1)
			pos_hint: {'x': .45, 'y': .3}
			on_press: root.manager.current = 'menu'
			on_release: root.stop_game()

<SettingsScreen@GameScreen>:
	name: 'settings'
	FloatLayout:
		Label:
			text: 'Settings'
			size_hint: (.2, .1)
			pos_hint: {'x': .45, 'y': .9}
		Button:
			text: 'Back'
			size_hint: (.2, .1)
			pos_hint: {'x': .45, 'y': .75}
			on_press: root.manager.current = 'menu'

<StatusPanel>:
	Label:
		pos: root.pos
		size: root.size
		font_size: root.size[1] * .5
		halign: 'center'
		valign: 'middle'
		color: (1, 1, 1, 1)
		text: 'FPS: ' + root.fps if root.fps != None else 'FPS:'
